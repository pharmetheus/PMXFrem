% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/createVPCdata.R
\name{createVPCdata}
\alias{createVPCdata}
\title{createVPCdata}
\usage{
createVPCdata(runno, modName = NULL, noBaseThetas, noSigmas,
  parNames = c("BASE", "PLMAX", "HLKON", "HLKOFF", "BASSL"), dataFile,
  fremDataFile, newDataFile = paste("vpcData", runno, ".csv", sep = ""),
  availCov = NULL, idvar = "ID", modDevDir = NULL, quiet = FALSE,
  cores = 1, ...)
}
\arguments{
\item{runno}{The run number to use to construct the file names (see Details).}

\item{modName}{The model name (see Details).}

\item{noBaseThetas}{The number of thetas in the base model, i.e. the number of non-covariate thetas.}

\item{noSigmas}{The number of sigma parameters in the model (including the sigma(s) associated with the covariates).}

\item{parNames}{Vector of the names of the parameters names in the base model, i.e. the names of the non-covariate parameters.}

\item{dataFile}{The name of the data file used in the base model, i.e. the original data file.}

\item{fremDataFile}{The name of the data file used in the frem model.}

\item{newDataFile}{The name of a new data file with the FFEM columns added. Default is vpcData{runno}.csv. If NULL, will return a data frame with the data instead of writing it to disk.}

\item{availCov}{The names of the covariates to use when computing the FFEM coefficients (using the FREM names, which will be different for categorical covaroates). Will use all covariates if NULL.}

\item{idvar}{The name of the ID column,}

\item{modDevDir}{The path to the directory where the NONMEM runs are.}

\item{quiet}{Whether the FFEM expression and re-computed OMEGA matrix should be output in the terminal.}

\item{cores}{How many cores to use in the calculations of the FFEM expressions.}
}
\value{
If newDataFile is NULL, a data frame. If quiet is FALSE, the FFEM expressions and new OMEGA matrix is printed in the console.
}
\description{
Add combined FFEM coefficients to the data set for the specified covariates.
}
\details{
This function will compute a combined term of all (FREM) covariate effects for each parameter in the FFEM model. The combined coefficients are added to the FFEM data set with names that
appends COV to the parameter name, e.g. the column with the combined covariate efftecs for parameter PAR will be called PARCOV. All rows for an individual will have the same value for PARCOV.

To implement an FFEM model with the covariate effects from the FREM analysis, change the FFEM model from:

PAR = TVPAR * EXP(ETA)

to

PAR = TVPAR * EXP(ETA + PARCOV)

the estimated FREM covariate effects will now impact PAR.(The PARCOV term should be added to the corresponding ETA).

To run a VPC for a FREM model, follow the following steps
\enumerate{
\item Create the VPC data set using this (createVPCdata) function.
\item Modify the FFEM model so that:
\itemize{
\item $DATA specifies the name of the vpc data file.
\item $INPUT includes the new columns.
\item the combined covariate coefficients are added to the etas (as above).
\item the initial estimates of the structural model thetas and sigmas are set to the estimates from the FREM model.
\item the initial estimate of the OMEGA BLOCK are set to be omega matrix that is printed in the terminal from the createVPCdata function (need to set quiet=FALSE).
\item the $SIM and $TABLE records are appropriately set.
}
\item Run the modified model :)
}
}
\examples{
\dontrun{
createVPCdata("11",noBaseThetas=11,noSigmas=3,dataFile="../../ProducedData/Dataset/smv1DatasetWHZ2.csv",fremDataFile="frem9.dir/frem_dataset.csv",
parNames=c("BASE","PLMAX","HLKON","HLKOFF","BASSL","BP","BASEW","PLMAXW","HLKONW","HLKOFFW","BASSLW"),newDataFile="vpcData11.csv",
availCov=c("BIRTHWT","BIRTHLEN"))

createVPCdata("13",noBaseThetas=11,noSigmas=3,dataFile="../../ProducedData/Dataset/smv1DatasetWHZ3.csv",fremDataFile="frem12.dir/frem_dataset.csv",
              parNames=c("BASE","PLMAX","HLKON","HLKOFF","BASSL","BP","BASEW","PLMAXW","HLKONW","HLKOFFW","BASSLW"),newDataFile="vpcData13.csv")
}
}
