% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/createFFEMmodel.R
\name{createFFEMmodel}
\alias{createFFEMmodel}
\title{createFFEMmode}
\usage{
createFFEMmodel(
  runno = NULL,
  numNonFREMThetas,
  modName = NULL,
  numFREMThetas = length(grep("THETA", names(dfext))) - numNonFREMThetas,
  covSuffix = "FREMCOV",
  parNames = paste("Par", 1:numParCov, sep = ""),
  numParCov = NULL,
  numSkipOm = 0,
  dataFile,
  newDataFile = paste("vpcData", runno, ".csv", sep = ""),
  availCov = "all",
  idvar = "ID",
  modDevDir = NULL,
  quiet = FALSE,
  cores = 1,
  dfext = NULL,
  baserunno = NULL,
  baseModName = NULL,
  baseModDevDir = modDevDir,
  ffemTabName = "ffemtab",
  ffemModName = NULL,
  ...
)
}
\arguments{
\item{runno}{The run number.}

\item{numNonFREMThetas}{Number of thetas that are not FREM covariates. These need to come before the FREM covariate thetas.}

\item{modName}{The model name. Default is the current directory, i.e. ".".}

\item{numFREMThetas}{The number thetas associated with FREM covariate effects.}

\item{covSuffix}{Use to create the column name fo rthe covariate effects columns. The column names will be the parameter name followed by this string.}

\item{parNames}{Names of the parameters}

\item{numParCov}{Number of parameters for which covariate relations are sought (often the same as numNonFREMThetas).
default (NULL) indicates that this is guessed by the function by assuming that each covariate effect is modelled as one theta and one eta.}

\item{numSkipOm}{Number of diag omegas (variances) that should not be part of the FREM calculations. 
Such omegas has to come before the large FREM omega block.}

\item{dataFile}{The name of the data file used in the base model, i.e. the original data file, or a data.frame with the same data.}

\item{newDataFile}{The name of a new data file with the FFEM columns added. Default is vpcData{runno}.csv. If NULL, will return a data frame with the data instead of writing it to disk.}

\item{availCov}{Names of the covariates to use in the calculation of the FFEM model.}

\item{idvar}{The name of the ID column,}

\item{modDevDir}{The directory where the files reside.}

\item{quiet}{If FALSE, will print the FFEM model + associated $OMEGA BLOCK}

\item{cores}{How many cores to use in the calculations of the FFEM expressions.}

\item{dfext}{A data frame of the ext file for the model. In case of multiple $EST, the dfext 
should contain the estimates of the *one* relevant $EST.}

\item{baserunno}{The run number of the base model.}

\item{baseModName}{The name of the base model}

\item{baseModDevDir}{The directory name in which the base model files can be found. Default the same as modDevDir.}

\item{ffemTabName}{The table file name to insert into the FFEM model. Default is 'ffemtab'.}

\item{ffemModName}{The name of the file to write the ffem model to, or NULL. NULL is the default}
}
\value{
A character vector with the code for the FFEM model.
}
\description{
createFFEMmode
}
\details{
This function creates an FFEM version of a frem model. The starting point is the base model. The following things are done to accomplish this:
\itemize{
\item Replace the data file with a file in which columns with individual covariate coefficients has been appended.
\item Append column names to $INPUT to match the new data file.
\item Update the initial estimates for $THETA and $SIGMA with the corresponding estimates from the frem run.
\item Replace the initial estimates of the OMEGAs with the adjusted OMEGA ("Omega prim") from the frem model.
\item Add the individual covariate coefficients to the corresponding ETAs (assuming the same order of the ETAs and the ndividual covariate coefficients).
\item Replace the options on $EST with MAX=1 METHOD=1 INTER. If more that one $EST is present in the file, the second, third, etc are removed.
\item Update any table file name with ffemTabName
}

It is important to check the FFEM model file so that it is correct.
}
\examples{
\dontrun{
ffemMod <- createFFEMmodel(runno            = 31,
                           modDevDir        = modDevDir,
                           numNonFREMThetas = 7,
                           numSkipOm        = 2,
                           parNames         = c("CL","V","MAT"),
                           dataFile         = "DAT-2-MI-PMX-2-onlyTYPE2-new.csv",
                           newDataFile      = "testFileName.csv",
                           quiet            = FALSE,
                           baserunno        = 30)
}
}
