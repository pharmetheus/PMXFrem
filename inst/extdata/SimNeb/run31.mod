;; 1. Based on: 30
;; 2. Description:
;;    Final frem30.dir mdoel
;; 3. Label:
;;    SimVal base model
;------------------------------------------------------------------------------
$PROBLEM    run 1
$INPUT      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT LBWT BSA SEX RACE AGE AST ALT BILI
            CRCL BMI NCI GENO2 ETHNIC SMOK RACEL NCIL FREMTYPE
$DATA      frem30.dir/frem_dataset.dta IGNORE=@
$SUBROUTINE ADVAN2 TRANS2
$PK
;;; MATFOOD-DEFINITION START
IF(FOOD.EQ.1) MATFOOD = 1  ; Most common
IF(FOOD.EQ.0) MATFOOD = ( 1 + THETA(6))
;;; MATFOOD-DEFINITION END

;;; MAT-RELATION START
MATCOVTIME = MATFOOD
;;; MAT-RELATION END


;;; FRELFOOD-DEFINITION START
IF(FOOD.EQ.1) FRELFOOD = 1  ; Most common
IF(FOOD.EQ.0) FRELFOOD = ( 1 + THETA(7))
;;; FRELFOOD-DEFINITION END

;;; FREL-RELATION START
FRELCOVTIME = FRELFOOD
;;; FREL-RELATION END

TVFREL  = THETA(1)
TVCL    = THETA(2)
TVV     = THETA(3)
TVMAT   = THETA(4)
TVD1    = THETA(5)

;MU_1  = LOG(TVRUV)
MU_2  = TVD1
MU_3  = LOG(TVCL)
MU_4  = LOG(TVV)
MU_5  = LOG(TVMAT)

D1FR  = MU_2                   + ETA(2)
FREL  = TVFREL*FRELCOVTIME
CL    = EXP(MU_3               + ETA(3))
V     = EXP(MU_4               + ETA(4))
MAT   = MATCOVTIME * EXP(MU_5  + ETA(5))
D1    = MAT*(1-D1FR)

F1    = FREL
KA    = 1 / (MAT-D1)
S2    = V

     MU_6 = THETA(8)
     COV6 = MU_6 + ETA(6)
     MU_7 = THETA(9)
     COV7 = MU_7 + ETA(7)
     MU_8 = THETA(10)
     COV8 = MU_8 + ETA(8)
     MU_9 = THETA(11)
     COV9 = MU_9 + ETA(9)
     MU_10 = THETA(12)
     COV10 = MU_10 + ETA(10)
     MU_11 = THETA(13)
     COV11 = MU_11 + ETA(11)
     MU_12 = THETA(14)
     COV12 = MU_12 + ETA(12)
     MU_13 = THETA(15)
     COV13 = MU_13 + ETA(13)
     MU_14 = THETA(16)
     COV14 = MU_14 + ETA(14)
     MU_15 = THETA(17)
     COV15 = MU_15 + ETA(15)
     MU_16 = THETA(18)
     COV16 = MU_16 + ETA(16)
     MU_17 = THETA(19)
     COV17 = MU_17 + ETA(17)
     MU_18 = THETA(20)
     COV18 = MU_18 + ETA(18)
     MU_19 = THETA(21)
     COV19 = MU_19 + ETA(19)
     MU_20 = THETA(22)
     COV20 = MU_20 + ETA(20)
     MU_21 = THETA(23)
     COV21 = MU_21 + ETA(21)
     MU_22 = THETA(24)
     COV22 = MU_22 + ETA(22)
     MU_23 = THETA(25)
     COV23 = MU_23 + ETA(23)
$ERROR
CP    = A(2)*1000 / V
IPRED = LOG(CP + 0.00001)
Y     = IPRED + EPS(1) * EXP(ETA(1))

;;;FREM CODE BEGIN COMPACT
;;;DO NOT MODIFY
     IF (FREMTYPE.EQ.100) THEN
;       WT  1
        Y = COV6 + EPS(2)
        IPRED = COV6
     END IF
     IF (FREMTYPE.EQ.200) THEN
;       HT  1
        Y = COV7 + EPS(2)
        IPRED = COV7
     END IF
     IF (FREMTYPE.EQ.300) THEN
;       LBWT  1
        Y = COV8 + EPS(2)
        IPRED = COV8
     END IF
     IF (FREMTYPE.EQ.400) THEN
;       BSA  1
        Y = COV9 + EPS(2)
        IPRED = COV9
     END IF
     IF (FREMTYPE.EQ.500) THEN
;       AGE  1
        Y = COV10 + EPS(2)
        IPRED = COV10
     END IF
     IF (FREMTYPE.EQ.600) THEN
;       AST  1
        Y = COV11 + EPS(2)
        IPRED = COV11
     END IF
     IF (FREMTYPE.EQ.700) THEN
;       ALT  1
        Y = COV12 + EPS(2)
        IPRED = COV12
     END IF
     IF (FREMTYPE.EQ.800) THEN
;       BILI  1
        Y = COV13 + EPS(2)
        IPRED = COV13
     END IF
     IF (FREMTYPE.EQ.900) THEN
;       CRCL  1
        Y = COV14 + EPS(2)
        IPRED = COV14
     END IF
     IF (FREMTYPE.EQ.1000) THEN
;       BMI  1
        Y = COV15 + EPS(2)
        IPRED = COV15
     END IF
     IF (FREMTYPE.EQ.1100) THEN
;       SEX  1
        Y = COV16 + EPS(2)
        IPRED = COV16
     END IF
     IF (FREMTYPE.EQ.1200) THEN
;       RACEL_3  1
        Y = COV17 + EPS(2)
        IPRED = COV17
     END IF
     IF (FREMTYPE.EQ.1300) THEN
;       RACEL_2  1
        Y = COV18 + EPS(2)
        IPRED = COV18
     END IF
     IF (FREMTYPE.EQ.1400) THEN
;       NCIL_2  1
        Y = COV19 + EPS(2)
        IPRED = COV19
     END IF
     IF (FREMTYPE.EQ.1500) THEN
;       NCIL_1  1
        Y = COV20 + EPS(2)
        IPRED = COV20
     END IF
     IF (FREMTYPE.EQ.1600) THEN
;       GENO2  1
        Y = COV21 + EPS(2)
        IPRED = COV21
     END IF
     IF (FREMTYPE.EQ.1700) THEN
;       ETHNIC  1
        Y = COV22 + EPS(2)
        IPRED = COV22
     END IF
     IF (FREMTYPE.EQ.1800) THEN
;       SMOK  1
        Y = COV23 + EPS(2)
        IPRED = COV23
     END IF
;;;FREM CODE END COMPACT
$THETA  1 FIX ; 1. TVFREL
$THETA  (0,6.11256) ; 2. TVCL
$THETA  (0,119.956) ; 3. TVV
$THETA  (0,1.95877) ; 4. TVMAT
$THETA  (0,0.674282) ; 5. D1
$THETA  (-1.00,-0.0507417,3.00) ; 6. FRELFOOD1
$THETA  (-1.00,0.121722,3.00) ; 7. MATFOOD1
$THETA  86.8571 ; TV_WT
 169.651 ; TV_HT
 57.5231 ; TV_LBWT
 2.01176 ; TV_BSA
 43.8174 ; TV_AGE
 25.526 ; TV_AST
 28.5375 ; TV_ALT
 9.819 ; TV_BILI
 119.209 ; TV_CRCL
 30.096 ; TV_BMI
 1.44109 ; TV_SEX
 0.0246228 ; TV_RACEL_3
 0.195916 ; TV_RACEL_2
 0.0224519 ; TV_NCIL_2
 0.157906 ; TV_NCIL_1
 1.80417 ; TV_GENO2
 0.458112 ; TV_ETHNIC
 0.0369859 ; TV_SMOK
$OMEGA  0.0542558  ; 1. IIV on RUV
$OMEGA  0.0001  FIX  ; 2. IIV on D1
$OMEGA  BLOCK(21)
 0.181946  ; 3. IIV on CL
 0.133749 0.185702  ; 4. IIV on V
 0.0182612 0.0353669 0.0543271  ; 5. IIV on MAT
 2.34953 3.64389 0.841018 432.468  ;     BSV_WT
 0.152563 0.114301 -0.102396 104.16 104.095  ;     BSV_HT
 0.6779 0.83315 0.0879201 181.108 94.8326 123.338  ;   BSV_LBWT
 0.0280968 0.043245 0.00899826 5.58919 1.81213 2.66581 0.0752052  ;    BSV_BSA
 0.659177 0.729083 0.424978 64.1908 -8.48858 16.6796 0.700872 177.075  ;    BSV_AGE
 -0.258053 0.142986 -0.190671 25.3271 14.1423 19.7265 0.3908 21.0064 125.125  ;    BSV_AST
 -0.235726 0.204357 0.00940339 52.1817 26.5364 40.4892 0.78231 19.4086 156.463 300.081  ;    BSV_ALT
 -0.470077 -0.251542 -0.174311 0.0396636 12.8709 10.0822 0.0752086 -12.7101 7.44592 10.903 27.8054  ;   BSV_BILI
 1.56839 2.67284 0.668478 267.044 54.8464 90.5976 3.43234 -145.021 3.80632 26.2453 -10.4082 626.459  ;   BSV_CRCL
 0.743484 1.19438 0.332951 109.792 -1.38751 27.3212 1.25827 24.7155 3.75278 8.79793 -4.31623 73.3635 38.2431  ;    BSV_BMI
 -0.0022343 0.0249387 0.00388339 -3.90625 -3.25386 -4.23284 -0.0643758 -0.337441 -0.79479 -1.8674 -0.747611 -0.115659 -0.208021 0.246867  ;    BSV_SEX
 -0.00508299 -0.00598765 -0.000359808 -0.281992 -0.142502 -0.11848 -0.00403694 0.0107844 -0.0282696 0.0287358 0.0581121 -0.152998 -0.0482635
 -0.00195069 0.0239943  ; BSV_RACEL_3
 -0.00218758 0.00563441 -0.00394574 0.413181 0.653414 0.345447 0.00822069 -0.948317 -0.267345 -1.21076 0.0430804 -0.90815 -0.098436 0.00168591
 -0.00496037 0.15775  ; BSV_RACEL_2
 -0.0105483 -0.00307747 -0.00365907 -0.0987466 0.0625931 0.047302 -0.000749648 -0.0293377 0.210611 0.314168 0.472404 -0.357176 -0.0531145 -0.00727027
 -0.000449422 0.000263048 0.0225495  ; BSV_NCIL_2
 -0.0284307 -0.00871224 -0.00857424 0.477443 0.718247 0.71875 0.0099476 -0.11123 1.61744 3.47661 0.701399 -0.0161363 -0.0871045 -0.0393437 0.00510424
 -0.00843525 -0.00364577 0.132108  ; BSV_NCIL_1
 0.119319 0.117953 0.00246888 -0.0197749 -0.257541 -0.180498 -0.00168893 0.281361 -0.0512536 -0.195151 -0.131669 -0.124679 0.0866922 0.0100885
 -0.00729361 -0.000391229 -0.000445899 -0.0140045 0.159078  ;  BSV_GENO2
 -0.0072382 -0.0287561 -0.00357215 -3.33609 -1.73754 -1.74532 -0.0489351 -0.134445 -0.481144 0.0144572 -0.290613 -1.02201 -0.530337 0.0265815
 -0.0112905 -0.0640035 -0.00398974 -0.0132286 0.020414 0.248867  ; BSV_ETHNIC
 0.014448 0.0126042 0.00121769 0.133439 0.0550999 0.000552539 0.00185967 -0.0757904 0.0383743 0.0911941 -0.0161975 -0.105007 0.0332071 0.004239
 0.0022296 -0.0031135 -0.000855839 -6.57168E-05 0.000271553 -0.0100031 0.0356666  ;   BSV_SMOK
$SIGMA  0.0310236  ;     1. RUV
$SIGMA  1E-07  FIX  ;     EPSCOV
$ESTIMATION METHOD=IMPMAP AUTO=1 RANMETHOD=3P INTER NOABORT PRINT=1
            NOCOV=1 ISAMPEND=100 NITER=50 ISAMPLE=300
$ESTIMATION METHOD=IMPMAP INTER EONLY=1 NITER=50 ISAMPLE=10000 NOCOV=0
            PHITYPE=1
;$COVARIANCE  UNCONDITIONAL
$TABLE      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT LBWT BSA SEX RACE AGE AST ALT BILI
            CRCL BMI NCI GENO2 ETHNIC SMOK RACE NCIL CPRED CIPREDI
            CWRES CIWRES ETAS(1:LAST) NOPRINT ONEHEADER FILE=xptab31

