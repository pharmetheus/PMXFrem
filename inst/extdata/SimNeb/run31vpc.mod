;; 1. Based on: 31
;; 2. Description:
;;    FFEM version of run31
;; 3. Label:
;;    SimVal base model
;------------------------------------------------------------------------------
$PROBLEM    run 1
$INPUT      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT LBWT BSA SEX RACE AGE AST ALT BILI
            CRCL BMI NCI GENO2 ETHNIC SMOK RACEL NCIL
            CLFREMCOV VFREMCOV MATFREMCOV
$DATA      newData4.csv
            IGNORE=@
$SUBROUTINE ADVAN2 TRANS2
$PK
;;; MATFOOD-DEFINITION START
IF(FOOD.EQ.1) MATFOOD = 1  ; Most common
IF(FOOD.EQ.0) MATFOOD = ( 1 + THETA(6))
;;; MATFOOD-DEFINITION END

;;; MAT-RELATION START
MATCOVTIME = MATFOOD
;;; MAT-RELATION END


;;; FRELFOOD-DEFINITION START
IF(FOOD.EQ.1) FRELFOOD = 1  ; Most common
IF(FOOD.EQ.0) FRELFOOD = ( 1 + THETA(7))
;;; FRELFOOD-DEFINITION END

;;; FREL-RELATION START
FRELCOVTIME = FRELFOOD
;;; FREL-RELATION END

TVFREL  = THETA(1)
TVCL    = THETA(2)
TVV     = THETA(3)
TVMAT   = THETA(4)
TVD1    = THETA(5)

;MU_1  = LOG(TVRUV)
MU_2  = TVD1
MU_3  = LOG(TVCL)
MU_4  = LOG(TVV)
MU_5  = LOG(TVMAT)

D1FR  = MU_2                   + ETA(2)
FREL  = TVFREL*FRELCOVTIME
CL    = EXP(MU_3               + ETA(3) + CLFREMCOV)
V     = EXP(MU_4               + ETA(4) + VFREMCOV)
MAT   = MATCOVTIME * EXP(MU_5  + ETA(5) + MATFREMCOV)
D1    = MAT*(1-D1FR)

F1    = FREL
KA    = 1 / (MAT-D1)
S2    = V

$ERROR
CP    = A(2)*1000 / V
IPRED = LOG(CP + 0.00001)
Y     = IPRED + EPS(1) * EXP(ETA(1))

REPI = IREP
$THETA  1 FIX ; 1. TVFREL
$THETA  (0,6.16183) ; 2. TVCL
$THETA  (0,123.734) ; 3. TVV
$THETA  (0,1.84939) ; 4. TVMAT
$THETA  (0,0.667194) ; 5. D1
$THETA  (-1.00,-0.048532,3.00) ; 6. FRELFOOD1
$THETA  (-1.00,0.123479,3.00) ; 7. MATFOOD1
$OMEGA  0.0559679  ; 1. IIV on RUV
$OMEGA  0.0001  FIX  ; 2. IIV on D1

$OMEGA BLOCK(3) 
0.06528
0.01976 0.05299
0.00526 0.02398 0.04117

$SIGMA  0.0309633  ;     1. RUV
$SIMULATION (1413) ONLYSIM NSUB=50
$TABLE      REPI ID DV TAD
            NOPRINT NOAPPEND ONEHEADERALL FILE=vpctab31

