;; 1. Based on: 
;; 2. Description:
;;    Re-run of frem3 model_4
;; 3. Label:
;;    SimVal base model
;------------------------------------------------------------------------------
$PROBLEM    run 1
$INPUT      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT LBWT BSA SEX RACE AGE AST ALT BILI
            CRCL BMI NCI GENO ETHNIC SMOK RACEL GENOL NCIL FREMTYPE
$DATA      frem3.dir/frem_dataset.dta IGNORE=@
$SUBROUTINE ADVAN2 TRANS2
$PK
;;; MATFOOD-DEFINITION START
IF(FOOD.EQ.1) MATFOOD = 1  ; Most common
IF(FOOD.EQ.0) MATFOOD = ( 1 + THETA(6))
;;; MATFOOD-DEFINITION END

;;; MAT-RELATION START
MATCOVTIME = MATFOOD
;;; MAT-RELATION END


;;; FRELFOOD-DEFINITION START
IF(FOOD.EQ.1) FRELFOOD = 1  ; Most common
IF(FOOD.EQ.0) FRELFOOD = ( 1 + THETA(7))
;;; FRELFOOD-DEFINITION END

;;; FREL-RELATION START
FRELCOVTIME = FRELFOOD
;;; FREL-RELATION END

TVFREL  = THETA(1)
TVCL    = THETA(2)
TVV     = THETA(3)
TVMAT   = THETA(4)
TVD1    = THETA(5)

;MU_1  = LOG(TVRUV)
MU_2  = TVD1
MU_3  = LOG(TVFREL)
MU_4  = LOG(TVCL)
MU_5  = LOG(TVV)
MU_6  = LOG(TVMAT)

D1FR  = MU_2                   + ETA(2)
FREL  = FRELCOVTIME * EXP(MU_3 + ETA(3))
CL    = EXP(MU_4               + ETA(4))
V     = EXP(MU_5               + ETA(5))
MAT   = MATCOVTIME * EXP(MU_6  + ETA(6))
D1    = MAT*(1-D1FR)

F1    = FREL
KA    = 1 / (MAT-D1)
S2    = V

     MU_7 = THETA(8)
     COV7 = MU_7 + ETA(7)
     MU_8 = THETA(9)
     COV8 = MU_8 + ETA(8)
     MU_9 = THETA(10)
     COV9 = MU_9 + ETA(9)
     MU_10 = THETA(11)
     COV10 = MU_10 + ETA(10)
     MU_11 = THETA(12)
     COV11 = MU_11 + ETA(11)
     MU_12 = THETA(13)
     COV12 = MU_12 + ETA(12)
     MU_13 = THETA(14)
     COV13 = MU_13 + ETA(13)
     MU_14 = THETA(15)
     COV14 = MU_14 + ETA(14)
     MU_15 = THETA(16)
     COV15 = MU_15 + ETA(15)
     MU_16 = THETA(17)
     COV16 = MU_16 + ETA(16)
     MU_17 = THETA(18)
     COV17 = MU_17 + ETA(17)
     MU_18 = THETA(19)
     COV18 = MU_18 + ETA(18)
     MU_19 = THETA(20)
     COV19 = MU_19 + ETA(19)
     MU_20 = THETA(21)
     COV20 = MU_20 + ETA(20)
     MU_21 = THETA(22)
     COV21 = MU_21 + ETA(21)
     MU_22 = THETA(23)
     COV22 = MU_22 + ETA(22)
     MU_23 = THETA(24)
     COV23 = MU_23 + ETA(23)
     MU_24 = THETA(25)
     COV24 = MU_24 + ETA(24)
     MU_25 = THETA(26)
     COV25 = MU_25 + ETA(25)
     MU_26 = THETA(27)
     COV26 = MU_26 + ETA(26)
$ERROR
CP    = A(2)*1000 / V
IPRED = LOG(CP + 0.00001)
Y     = IPRED + EPS(1) * EXP(ETA(1))

;;;FREM CODE BEGIN COMPACT
;;;DO NOT MODIFY
     IF (FREMTYPE.EQ.100) THEN
;       WT  1
        Y = COV7 + EPS(2)
        IPRED = COV7
     END IF
     IF (FREMTYPE.EQ.200) THEN
;       HT  1
        Y = COV8 + EPS(2)
        IPRED = COV8
     END IF
     IF (FREMTYPE.EQ.300) THEN
;       LBWT  1
        Y = COV9 + EPS(2)
        IPRED = COV9
     END IF
     IF (FREMTYPE.EQ.400) THEN
;       BSA  1
        Y = COV10 + EPS(2)
        IPRED = COV10
     END IF
     IF (FREMTYPE.EQ.500) THEN
;       AGE  1
        Y = COV11 + EPS(2)
        IPRED = COV11
     END IF
     IF (FREMTYPE.EQ.600) THEN
;       AST  1
        Y = COV12 + EPS(2)
        IPRED = COV12
     END IF
     IF (FREMTYPE.EQ.700) THEN
;       ALT  1
        Y = COV13 + EPS(2)
        IPRED = COV13
     END IF
     IF (FREMTYPE.EQ.800) THEN
;       BILI  1
        Y = COV14 + EPS(2)
        IPRED = COV14
     END IF
     IF (FREMTYPE.EQ.900) THEN
;       CRCL  1
        Y = COV15 + EPS(2)
        IPRED = COV15
     END IF
     IF (FREMTYPE.EQ.1000) THEN
;       BMI  1
        Y = COV16 + EPS(2)
        IPRED = COV16
     END IF
     IF (FREMTYPE.EQ.1100) THEN
;       SEX  1
        Y = COV17 + EPS(2)
        IPRED = COV17
     END IF
     IF (FREMTYPE.EQ.1200) THEN
;       RACEL_3  1
        Y = COV18 + EPS(2)
        IPRED = COV18
     END IF
     IF (FREMTYPE.EQ.1300) THEN
;       RACEL_2  1
        Y = COV19 + EPS(2)
        IPRED = COV19
     END IF
     IF (FREMTYPE.EQ.1400) THEN
;       NCIL_2  1
        Y = COV20 + EPS(2)
        IPRED = COV20
     END IF
     IF (FREMTYPE.EQ.1500) THEN
;       NCIL_1  1
        Y = COV21 + EPS(2)
        IPRED = COV21
     END IF
     IF (FREMTYPE.EQ.1600) THEN
;       GENOL_4  1
        Y = COV22 + EPS(2)
        IPRED = COV22
     END IF
     IF (FREMTYPE.EQ.1700) THEN
;       GENOL_3  1
        Y = COV23 + EPS(2)
        IPRED = COV23
     END IF
     IF (FREMTYPE.EQ.1800) THEN
;       GENOL_2  1
        Y = COV24 + EPS(2)
        IPRED = COV24
     END IF
     IF (FREMTYPE.EQ.1900) THEN
;       ETHNIC  1
        Y = COV25 + EPS(2)
        IPRED = COV25
     END IF
     IF (FREMTYPE.EQ.2000) THEN
;       SMOK  1
        Y = COV26 + EPS(2)
        IPRED = COV26
     END IF
;;;FREM CODE END COMPACT
$THETA  1 FIX ; 1. TVFREL
$THETA  (0,7.62475) ; 2. TVCL
$THETA  (0,149.309) ; 3. TVV
$THETA  (0,2.00744) ; 4. TVMAT
$THETA  (0,0.681295) ; 5. D1
$THETA  (-1.00,-0.081395,3.00) ; 6. FRELFOOD1
$THETA  (-1.00,0.109207,3.00) ; 7. MATFOOD1
$THETA  86.9256 ; TV_WT
 169.538 ; TV_HT
 57.4682 ; TV_LBWT
 2.01142 ; TV_BSA
 44.8689 ; TV_AGE
 24.7492 ; TV_AST
 27.6331 ; TV_ALT
 9.79207 ; TV_BILI
 117.294 ; TV_CRCL
 30.1222 ; TV_BMI
 1.43827 ; TV_SEX
 0.0247096 ; TV_RACEL_3
 0.209046 ; TV_RACEL_2
 0.0169046 ; TV_NCIL_2
 0.136677 ; TV_NCIL_1
 0.0492582 ; TV_GENOL_4
 0.0967542 ; TV_GENOL_3
 0.821929 ; TV_GENOL_2
 0.423527 ; TV_ETHNIC
 0.0588927 ; TV_SMOK
$OMEGA  0.112474  ; 1. IIV on RUV
$OMEGA  0.0001  FIX  ;         D1
$OMEGA  BLOCK(24)
 0.573289  ; 2. IIV on FREL
 0.292478 0.506629  ; 3. IIV on CL
 0.197851 0.19417 0.491526  ; 4. IIV on V
 0.0190784 -0.0151476 0.024398 0.16116  ; 5. IIV on MAT
 1.46236 4.784 5.98048 -1.05634 461.767  ;     BSV_WT
 5.20062 6.17885 5.59689 -0.149644 110.089 105.348  ;     BSV_HT
 3.94853 5.31229 4.97353 -0.500602 181.744 96.3513 123.191  ;   BSV_LBWT
 0.0476945 0.09089 0.101595 -0.0127428 5.90376 1.88246 2.67378 0.0786058  ;    BSV_BSA
 -0.916532 -0.399308 -0.243134 -0.15957 35.4851 -7.37968 6.97692 0.372284 171.52  ;    BSV_AGE
 0.20363 0.151074 0.0999074 -0.588844 9.57345 3.97221 9.39862 0.156672 15.1084 129.764  ;    BSV_AST
 0.963441 0.624023 0.599283 -0.643372 59.09 15.477 30.8811 0.778082 14.4939 143.172 248.862  ;    BSV_ALT
 0.535359 0.231662 0.401653 0.191396 -13.3783 4.35781 1.66214 -0.12868 -8.09519 -1.91065 6.45365 24.721  ;   BSV_BILI
 -0.553895 1.74862 3.66198 -0.815566 310.173 58.6545 107.519 3.93691 -157.296 -9.46096 34.9885 -3.12249 651.129  ;   BSV_CRCL
 -1.32418 -0.549753 0.0787922 -0.302858 117.089 0.631705 27.2685 1.33827 14.867 2.96056 15.3247 -6.05767 85.4835 39.6583  ;    BSV_BMI
 -0.174986 -0.210366 -0.157239 0.0181726 -3.91716 -3.38988 -4.29462 -0.0651875 -0.159601 -0.605728 -1.36511 -0.362879 -0.630375 -0.152555
 0.246874  ;    BSV_SEX
 -0.00373116 -0.0032345 -0.00439608 -0.00915658 -0.266701 -0.0829055 -0.090194 -0.00383246 0.147559 -0.0326339 -0.0575271 0.0465754 -0.494511
 -0.0698309 -0.00496308 0.0243524  ; BSV_RACEL_3
 0.0265068 0.0132077 0.0274279 0.00365558 0.490744 0.42519 0.231609 0.00820283 -1.12447 0.0974785 -0.712486 0.127242 0.236574 0.0283115 0.00894064
 -0.00519139 0.163028  ; BSV_RACEL_2
 0.00584403 0.002966 0.00766697 0.00218321 -0.203098 0.0654869 -0.034802 -0.00213327 -0.0534062 -0.10345 -0.0409083 0.351 -0.15117 -0.0883315
 -0.00194316 -0.000476513 0.000941145 0.0167125  ; BSV_NCIL_2
 0.0192543 -0.00777183 0.0076749 -0.0050015 0.726839 0.0991312 0.283042 0.0090228 -0.116129 1.6128 2.80886 0.759339 0.779697 0.233032 -0.0144717
 0.00112702 0.00283309 -0.00242575 0.117777  ; BSV_NCIL_1
 0.00495482 0.00546974 0.00480833 0.0030633 -0.0330046 0.0730161 0.0166902 -3.38298E-06 0.39665 0.0362058 -0.0270961 -0.111674 -0.564838 -0.041624
 0.000768289 -0.000924969 -0.00601931 -0.00085431 -0.00325794 0.0480158  ; BSV_GENOL_4
 0.0202864 0.0250718 0.0122623 -2.75699E-05 0.0349543 0.348539 0.220938 0.00217636 -0.439802 -0.0382378 0.0139967 0.201035 -0.0256422 -0.107027
 -0.0152562 0.0083379 0.0106989 0.00347524 0.00407379 -0.00479793 0.0856268  ; BSV_GENOL_3
 -0.029523 -0.0347428 -0.00878071 -0.00767921 0.195503 -0.3817 -0.225299 0.000246986 -0.0581886 0.143572 0.0956685 -0.193915 0.708016 0.204433
 0.0191649 -0.00656114 -0.00386445 -0.00386301 -0.00446401 -0.0416731 -0.077828 0.145502  ; BSV_GENOL_2
 -0.0619254 -0.0639183 -0.0770854 -0.00627401 -2.82484 -1.35363 -1.29622 -0.0403697 -0.834467 -0.313915 0.470904 0.017621 -0.273292 -0.499007
 0.0113729 -0.00928145 -0.0752694 -0.00049496 -0.000903791 -0.00700144 -0.0124909 0.0102609 0.24484  ; BSV_ETHNIC
 -0.000385664 0.00378786 0.00125565 -0.00838716 0.0635867 0.0612651 -0.000979778 0.00113572 0.125897 -0.0762281 -0.409735 -0.101925 -0.173181
 -4.80948E-05 0.00416101 -0.0012174 -0.00984898 -0.000956994 -0.00527731 0.00969792 0.00106489 -0.00877293 -0.0165046 0.0555101  ;   BSV_SMOK
$SIGMA  0.0319588  ;     1. RUV
$SIGMA  1E-07  FIX  ;     EPSCOV
$ESTIMATION METHOD=IMPMAP AUTO=1 RANMETHOD=3P INTER NOABORT PRINT=1
            CITER=15 NOCOV=1 ISAMPEND=100 NITER=50 ISAMPLE=300 CTYPE=1
            CALPHA=0.001
$ESTIMATION METHOD=IMPMAP INTER EONLY=1 NITER=5 ISAMPLE=1000 NOCOV=0 PHITYPE=1
$COVARIANCE PRINT=E UNCONDITIONAL
;$COVARIANCE PRINT=E MATRIX=S UNCONDITIONAL UNCONDITIONAL
$TABLE      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT LBWT BSA SEX RACE AGE AST ALT BILI
            CRCL BMI NCI GENO ETHNIC SMOK RACEL GENOL NCIL CPRED
            CIPREDI CWRES CIWRES ETAS(1:LAST) NOPRINT ONEHEADER
            FILE=xptab4

