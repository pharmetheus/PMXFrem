;; 1. Based on: 30
;; 2. Description:
;;    Final frem30.dir mdoel
;; 3. Label:
;;    SimVal base model
;------------------------------------------------------------------------------
$PROBLEM    run 1
$INPUT      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT LBWT BSA SEX RACE AGE AST ALT BILI
            CRCL BMI NCI GENO2 ETHNIC SMOK RACEL NCIL FREMTYPE
$DATA  IGNORE=@
$SUBROUTINE ADVAN2 TRANS2
$PK
;;; MATFOOD-DEFINITION START
IF(FOOD.EQ.1) MATFOOD = 1  ; Most common
IF(FOOD.EQ.0) MATFOOD = ( 1 + THETA(6))
;;; MATFOOD-DEFINITION END

;;; MAT-RELATION START
MATCOVTIME = MATFOOD
;;; MAT-RELATION END


;;; FRELFOOD-DEFINITION START
IF(FOOD.EQ.1) FRELFOOD = 1  ; Most common
IF(FOOD.EQ.0) FRELFOOD = ( 1 + THETA(7))
;;; FRELFOOD-DEFINITION END

;;; FREL-RELATION START
FRELCOVTIME = FRELFOOD
;;; FREL-RELATION END

TVFREL  = THETA(1)
TVCL    = THETA(2)
TVV     = THETA(3)
TVMAT   = THETA(4)
TVD1    = THETA(5)

;MU_1  = LOG(TVRUV)
MU_2  = TVD1
MU_3  = LOG(TVCL)
MU_4  = LOG(TVV)
MU_5  = LOG(TVMAT)

D1FR  = MU_2                   + ETA(2)
FREL  = TVFREL*FRELCOVTIME
CL    = EXP(MU_3               + ETA(3))
V     = EXP(MU_4               + ETA(4))
MAT   = MATCOVTIME * EXP(MU_5  + ETA(5))
D1    = MAT*(1-D1FR)

F1    = FREL
KA    = 1 / (MAT-D1)
S2    = V



      MU_6 = THETA(8)
      COV6 = MU_6 + ETA(6)
      MU_7 = THETA(9)
      COV7 = MU_7 + ETA(7)
      MU_8 = THETA(10)
      COV8 = MU_8 + ETA(8)
      MU_9 = THETA(11)
      COV9 = MU_9 + ETA(9)
      MU_10 = THETA(12)
      COV10 = MU_10 + ETA(10)
      MU_11 = THETA(13)
      COV11 = MU_11 + ETA(11)
      MU_12 = THETA(14)
      COV12 = MU_12 + ETA(12)
      MU_13 = THETA(15)
      COV13 = MU_13 + ETA(13)
      MU_14 = THETA(16)
      COV14 = MU_14 + ETA(14)
      MU_15 = THETA(17)
      COV15 = MU_15 + ETA(15)
      MU_16 = THETA(18)
      COV16 = MU_16 + ETA(16)
      MU_17 = THETA(19)
      COV17 = MU_17 + ETA(17)
      MU_18 = THETA(20)
      COV18 = MU_18 + ETA(18)
      MU_19 = THETA(21)
      COV19 = MU_19 + ETA(19)
      MU_20 = THETA(22)
      COV20 = MU_20 + ETA(20)
      MU_21 = THETA(23)
      COV21 = MU_21 + ETA(21)
      MU_22 = THETA(24)
      COV22 = MU_22 + ETA(22)
$ERROR
CP    = A(2)*1000 / V
IPRED = LOG(CP + 0.00001)
Y     = IPRED + EPS(1) * EXP(ETA(1))



;;;FREM CODE BEGIN COMPACT
      IF(FREMTYPE.EQ.100) THEN
;       WT
        Y = COV6 + EPS(2)
        IPRED = COV6
      ENDIF
      IF(FREMTYPE.EQ.200) THEN
;       HT
        Y = COV7 + EPS(2)
        IPRED = COV7
      ENDIF
      IF(FREMTYPE.EQ.300) THEN
;       LBWT
        Y = COV8 + EPS(2)
        IPRED = COV8
      ENDIF
      IF(FREMTYPE.EQ.400) THEN
;       BSA
        Y = COV9 + EPS(2)
        IPRED = COV9
      ENDIF
      IF(FREMTYPE.EQ.500) THEN
;       AGE
        Y = COV10 + EPS(2)
        IPRED = COV10
      ENDIF
      IF(FREMTYPE.EQ.600) THEN
;       AST
        Y = COV11 + EPS(2)
        IPRED = COV11
      ENDIF
      IF(FREMTYPE.EQ.700) THEN
;       ALT
        Y = COV12 + EPS(2)
        IPRED = COV12
      ENDIF
      IF(FREMTYPE.EQ.800) THEN
;       BILI
        Y = COV13 + EPS(2)
        IPRED = COV13
      ENDIF
      IF(FREMTYPE.EQ.900) THEN
;       CRCL
        Y = COV14 + EPS(2)
        IPRED = COV14
      ENDIF
      IF(FREMTYPE.EQ.1000) THEN
;       BMI
        Y = COV15 + EPS(2)
        IPRED = COV15
      ENDIF
      IF(FREMTYPE.EQ.1100) THEN
;       RACEL_3
        Y = COV16 + EPS(2)
        IPRED = COV16
      ENDIF
      IF(FREMTYPE.EQ.1200) THEN
;       RACEL_2
        Y = COV17 + EPS(2)
        IPRED = COV17
      ENDIF
      IF(FREMTYPE.EQ.1300) THEN
;       NCIL_2
        Y = COV18 + EPS(2)
        IPRED = COV18
      ENDIF
      IF(FREMTYPE.EQ.1400) THEN
;       NCIL_1
        Y = COV19 + EPS(2)
        IPRED = COV19
      ENDIF
      IF(FREMTYPE.EQ.1500) THEN
;       GENO2
        Y = COV20 + EPS(2)
        IPRED = COV20
      ENDIF
      IF(FREMTYPE.EQ.1600) THEN
;       ETHNIC
        Y = COV21 + EPS(2)
        IPRED = COV21
      ENDIF
      IF(FREMTYPE.EQ.1700) THEN
;       SMOK
        Y = COV22 + EPS(2)
        IPRED = COV22
      ENDIF
;;;FREM CODE END COMPACT

$THETA 1 FIX  ; 1 TV_BASE1
$THETA 6.17489  ; 2 TV_BASE2
$THETA 123.72  ; 3 TV_BASE3
$THETA 1.86813  ; 4 TV_BASE4
$THETA 0.666833  ; 5 TV_BASE5
$THETA -0.0551668  ; 6 TV_BASE6
$THETA 0.1326  ; 7 TV_BASE7
$THETA 86.8533  ; 8 TV_WT
$THETA 169.651  ; 9 TV_HT
$THETA 57.5143  ; 10 TV_LBWT
$THETA 2.01171  ; 11 TV_BSA
$THETA 43.8048  ; 12 TV_AGE
$THETA 25.542  ; 13 TV_AST
$THETA 28.5022  ; 14 TV_ALT
$THETA 9.81823  ; 15 TV_BILI
$THETA 119.285  ; 16 TV_CRCL
$THETA 30.0935  ; 17 TV_BMI
$THETA 0.0245902  ; 18 TV_RACEL_3
$THETA 0.196098  ; 19 TV_RACEL_2
$THETA 0.0224704  ; 20 TV_NCIL_2
$THETA 0.157421  ; 21 TV_NCIL_1
$THETA 1.8032  ; 22 TV_GENO2
$THETA 0.458589  ; 23 TV_ETHNIC
$THETA 0.0369861  ; 24 TV_SMOK
$OMEGA BLOCK(1) 
0.0551649 
$OMEGA BLOCK(1) 
0.000116094 
$OMEGA BLOCK(20) 
0.183694   ; 3 BSV_BASE3
0.138827 0.200023   ; 4 BSV_BASE4
0.0123448 0.0254075 0.0476874   ; 5 BSV_BASE5
2.3941 3.95563 0.185568 434.104   ; 6 BSV_WT
0.118969 0.0060112 0.113939 104 104.095   ; 7 BSV_HT
0.638755 0.753182 0.203469 181.665 94.7357 123.461   ; 8 BSV_LBWT
0.0283623 0.046066 0.00291337 5.60708 1.81051 2.67184 0.0754029   ; 9 BSV_BSA
0.693113 0.901184 0.0169782 63.8584 -8.30336 16.4586 0.697718 177.814   ; 10 BSV_AGE
-0.265491 0.159895 -0.308241 25.6286 14.3207 20.3521 0.39578 21.627 125.595   ; 11 BSV_AST
-0.249637 0.146304 0.121545 52.588 26.5557 40.8902 0.78794 20.2094 156.793 299.97   ; 12 BSV_ALT
-0.476454 -0.289272 -0.11408 0.0433564 12.8859 10.0499 0.075132 -12.8881 7.73622 10.9686 27.8108   ; 13 BSV_BILI
1.65457 2.90078 0.305008 269.646 54.5547 91.693 3.45973 -146.287 2.88634 25.5172 -11.2933 631.706   ; 14 BSV_CRCL
0.772157 1.34796 0.0117214 110.435 -1.43241 27.5662 1.26533 24.5285 3.83095 8.94584 -4.30816 74.3695 38.4847   ; 15 BSV_BMI
-0.00490766 -0.00639512 0.00117313 -0.283725 -0.147047 -0.124473 -0.00409009 0.0169571 -0.0278788 0.0296585 0.0566026 -0.136263 -0.047744 0.0240297   ; 16 BSV_RACEL_3
-0.0024188 0.00527979 -0.00218323 0.414273 0.650629 0.346294 0.00822938 -0.959747 -0.246373 -1.21109 0.040256 -0.873395 -0.0967988 -0.00502836 0.157741   ; 17 BSV_RACEL_2
-0.0106453 -0.00380084 -0.0026421 -0.103752 0.0634981 0.0443651 -0.000798562 -0.0372864 0.216275 0.313907 0.472608 -0.370428 -0.0551989 -0.000469918 0.000314039 0.0225625   ; 18 BSV_NCIL_2
-0.0287403 -0.0111923 -0.00388014 0.484006 0.719672 0.732211 0.0100409 -0.10856 1.61068 3.47516 0.701141 -0.0586527 -0.0847343 0.00505769 -0.00859566 -0.00370609 0.132058   ; 19 BSV_NCIL_1
0.118842 0.117957 0.00196097 -0.0311726 -0.242087 -0.173611 -0.00172917 0.287934 -0.0634738 -0.200353 -0.126555 -0.0870974 0.0759638 -0.00743327 -0.000737226 -0.000553235 -0.0129684 0.158649   ; 20 BSV_GENO2
-0.00842435 -0.032388 0.00211288 -3.34658 -1.75236 -1.76219 -0.0491455 -0.132199 -0.494224 0.00704007 -0.29364 -1.03298 -0.528109 -0.0111578 -0.0640721 -0.00386051 -0.0136643 0.0206967 0.249198   ; 21 BSV_ETHNIC
0.014238 0.0122447 0.00147499 0.133606 0.0551143 0.000891277 0.00186186 -0.0740465 0.0317411 0.0938387 -0.0168279 -0.10566 0.0332996 0.00217189 -0.00310031 -0.000846107 -3.39826e-05 5.35366e-05 -0.0101204 0.0356664   ; 22 BSV_SMOK
$SIGMA  0.0310236  ;     1. RUV
$SIGMA  1E-07  FIX  ;     EPSCOV
$ESTIMATION METHOD=IMPMAP AUTO=1 RANMETHOD=3P INTER NOABORT PRINT=1
            NOCOV=1 ISAMPEND=100 NITER=50 ISAMPLE=300
$ESTIMATION METHOD=IMPMAP INTER EONLY=1 NITER=50 ISAMPLE=10000 NOCOV=0
            PHITYPE=1
;$COVARIANCE  UNCONDITIONAL
$TABLE      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT LBWT BSA SEX RACE AGE AST ALT BILI
            CRCL BMI NCI GENO2 ETHNIC SMOK RACE NCIL CPRED CIPREDI
            CWRES CIWRES ETAS(1:LAST) NOPRINT ONEHEADER FILE=xptab31

