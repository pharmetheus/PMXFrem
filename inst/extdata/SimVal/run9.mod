;; 1. Based on: 7
;; 2. Description:
;;    Re-run of final frem model
;; 3. Label:
;;    Base model
;------------------------------------------------------------------------------
$PROBLEM    run 1
$INPUT      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT AGE SEX RACE ETHNIC GENO SMOK AST ALT
            BILI BMI CRCL NCI NCIL RACEL RACEL1 RACEL2 RACEL3 GENO1
            GENO2 GENO3 GENO4 FREMTYPE
$DATA      frem8.dir/frem_dataset.dta IGNORE=@
$SUBROUTINE ADVAN2 TRANS2
$PK
;;; MATFOOD-DEFINITION START
IF(FOOD.EQ.1.0000E+00) MATFOOD = 1  ; Most common
IF(FOOD.EQ.0.0000E+00) MATFOOD = ( 1 + THETA(9))
;;; MATFOOD-DEFINITION END

;;; MAT-RELATION START
MATCOVTIME = MATFOOD
;;; MAT-RELATION END


;;; FRELFOOD-DEFINITION START
IF(FOOD.EQ.1.0000E+00) FRELFOOD = 1  ; Most common
IF(FOOD.EQ.0.0000E+00) FRELFOOD = ( 1 + THETA(8))
;;; FRELFOOD-DEFINITION END

;;; FREL-RELATION START
FRELCOVTIME = FRELFOOD
;;; FREL-RELATION END

CLWT    = (WT/75)**THETA(2)
CLCOV   = CLWT

VWT     = (WT/75)**THETA(3)
VCOV    = VWT
 
TVFREL  = THETA(1)
TVCL    = THETA(4) * CLCOV
TVV     = THETA(5) * VCOV
TVMAT   = THETA(6)
TVD1    = THETA(7)

;MU_1  = LOG(TVRUV)
MU_2  = TVD1
MU_3  = LOG(TVFREL)
MU_4  = LOG(TVCL)
MU_5  = LOG(TVV)
MU_6  = LOG(TVMAT)

D1FR  = MU_2                   + ETA(2)
FREL  = FRELCOVTIME * EXP(MU_3 + ETA(3))
CL    = EXP(MU_4               + ETA(4))
V     = EXP(MU_5               + ETA(5))
MAT   = MATCOVTIME * EXP(MU_6  + ETA(6))
D1    = MAT*(1-D1FR)

F1    = FREL
KA    = 1 / (MAT-D1)
S2    = V

     MU_7 = THETA(10)
     COV7 = MU_7 + ETA(7)
     MU_8 = THETA(11)
     COV8 = MU_8 + ETA(8)
     MU_9 = THETA(12)
     COV9 = MU_9 + ETA(9)
     MU_10 = THETA(13)
     COV10 = MU_10 + ETA(10)
     MU_11 = THETA(14)
     COV11 = MU_11 + ETA(11)
     MU_12 = THETA(15)
     COV12 = MU_12 + ETA(12)
     MU_13 = THETA(16)
     COV13 = MU_13 + ETA(13)
     MU_14 = THETA(17)
     COV14 = MU_14 + ETA(14)
     MU_15 = THETA(18)
     COV15 = MU_15 + ETA(15)
     MU_16 = THETA(19)
     COV16 = MU_16 + ETA(16)
     MU_17 = THETA(20)
     COV17 = MU_17 + ETA(17)
     MU_18 = THETA(21)
     COV18 = MU_18 + ETA(18)
     MU_19 = THETA(22)
     COV19 = MU_19 + ETA(19)
     MU_20 = THETA(23)
     COV20 = MU_20 + ETA(20)
$ERROR
CP    = A(2)*1000 / V
IPRED = LOG(CP + 0.00001)
Y     = IPRED + EPS(1) * EXP(ETA(1))

;;;FREM CODE BEGIN COMPACT
;;;DO NOT MODIFY
     IF (FREMTYPE.EQ.100) THEN
;       AGE  1
        Y = COV7 + EPS(2)
        IPRED = COV7
     END IF
     IF (FREMTYPE.EQ.200) THEN
;       AST  1
        Y = COV8 + EPS(2)
        IPRED = COV8
     END IF
     IF (FREMTYPE.EQ.300) THEN
;       BILI  1
        Y = COV9 + EPS(2)
        IPRED = COV9
     END IF
     IF (FREMTYPE.EQ.400) THEN
;       CRCL  1
        Y = COV10 + EPS(2)
        IPRED = COV10
     END IF
     IF (FREMTYPE.EQ.500) THEN
;       BMI  1
        Y = COV11 + EPS(2)
        IPRED = COV11
     END IF
     IF (FREMTYPE.EQ.600) THEN
;       ALT  1
        Y = COV12 + EPS(2)
        IPRED = COV12
     END IF
     IF (FREMTYPE.EQ.700) THEN
;       SEX  1
        Y = COV13 + EPS(2)
        IPRED = COV13
     END IF
     IF (FREMTYPE.EQ.800) THEN
;       RACEL_3  1
        Y = COV14 + EPS(2)
        IPRED = COV14
     END IF
     IF (FREMTYPE.EQ.900) THEN
;       RACEL_2  1
        Y = COV15 + EPS(2)
        IPRED = COV15
     END IF
     IF (FREMTYPE.EQ.1000) THEN
;       NCI_2  1
        Y = COV16 + EPS(2)
        IPRED = COV16
     END IF
     IF (FREMTYPE.EQ.1100) THEN
;       NCI_1  1
        Y = COV17 + EPS(2)
        IPRED = COV17
     END IF
     IF (FREMTYPE.EQ.1200) THEN
;       GENO_4  1
        Y = COV18 + EPS(2)
        IPRED = COV18
     END IF
     IF (FREMTYPE.EQ.1300) THEN
;       GENO_3  1
        Y = COV19 + EPS(2)
        IPRED = COV19
     END IF
     IF (FREMTYPE.EQ.1400) THEN
;       GENO_2  1
        Y = COV20 + EPS(2)
        IPRED = COV20
     END IF
;;;FREM CODE END COMPACT
$THETA  0.75 FIX ; 1. WT coef on TVCL
$THETA  1 FIX ; 2. WT coef on TVV
$THETA  1 FIX ; 3. TVFREL
$THETA  (0,6.98111) ; 4. TVCL
$THETA  (0,132.838) ; 5. TVV
$THETA  (0,2.03465) ; 6. TVMAT
$THETA  (0,0.68115) ; 7. D1
$THETA  (-1.00,0.10981,3.00) ; FRELFOOD1
$THETA  (-1.00,-0.0805419,3.00) ; MATFOOD1
$THETA  44.3028 ; TV_AGE
 24.9468 ; TV_AST
 9.65924 ; TV_BILI
 117.632 ; TV_CRCL
 30.145 ; TV_BMI
 27.5527 ; TV_ALT
 1.44045 ; TV_SEX
 0.0245749 ; TV_RACEL_3
 0.207003 ; TV_RACEL_2
 0.0163928 ; TV_NCI_2
 0.134599 ; TV_NCI_1
 0.0560756 ; TV_GENO_4
 0.0986099 ; TV_GENO_3
 0.817952 ; TV_GENO_2
$OMEGA  0.113183  ; 1. IIV on RUV
$OMEGA  0.0001  FIX  ;         D1
$OMEGA  BLOCK(18)
 0.412282  ; 2. IIV on FREL
 0.0929451 0.248693  ; 3. IIV on CL
 0.0692838 -0.00252866 0.35457  ; 4. IIV on V
 0.00332789 -0.0233881 0.0194316 0.157357  ; 5. IIV on MAT
 0.713883 0.960496 0.830599 0.0624659 175.792  ;    BSV_AGE
 0.731516 0.366283 0.144528 -0.215059 10.5186 122.655  ;    BSV_AST
 -0.0843648 -0.302459 -0.102878 0.111606 -8.8638 -3.74083 24.0879  ;   BSV_BILI
 6.13996 5.89434 6.64104 -0.901022 -150.445 -6.49043 -5.04868 635.042  ;   BSV_CRCL
 2.15874 1.9503 2.2868 -0.235758 17.7528 2.64686 -6.14608 80.8449 39.3708  ;    BSV_BMI
 1.6026 0.868909 0.812859 -0.476459 12.7559 145.292 0.54931 25.6887 12.0099 263.349  ;    BSV_ALT
 -0.0654028 -0.067776 -0.00241041 0.00979531 -0.199291 -0.613995 -0.346349 -0.582023 -0.132503 -1.39361 0.246868  ;    BSV_SEX
 -0.00853666 -0.00556869 -0.00497677 -0.0122868 0.079083 0.0618372 0.0359832 -0.394485 -0.0669875 -0.0516482 -0.00403235 0.0240819  ; BSV_RACEL_3
 0.0160534 -0.00166497 0.00611968 0.00434832 -1.10795 0.0358356 0.087222 0.16987 0.0400584 -0.743558 0.00877071 -0.0051073 0.164289  ; BSV_RACEL_2
 -0.00466274 -0.00559536 -0.000340068 0.00166489 -0.0789521 -0.111517 0.347764 -0.11559 -0.0866741 -0.0747227 -0.00177289 -0.000405813 0.000710118
 0.0161898  ;  BSV_NCI_2
 0.0357558 0.00486565 0.0164265 -0.00342927 -0.0946516 1.37299 0.693306 0.636319 0.221354 2.78653 -0.0154021 0.000800781 0.00237226 -0.00221056
 0.116382  ;  BSV_NCI_1
 -0.00919492 -0.00441208 -0.00604274 0.00179399 0.165799 -0.0405 -0.0951704 -0.715577 -0.0887147 -0.126209 0.00125462 -0.00138728 -0.00751827
 -0.000924201 -0.00480676 0.0530824  ; BSV_GENO_4
 -0.00220283 0.000705191 -0.00992484 0.000308332 -0.454452 -0.0818537 0.197915 0.0123424 -0.0944038 -0.0242677 -0.0175026 0.00716816 0.0124926
 0.00386375 0.00594466 -0.0055476 0.0890234  ; BSV_GENO_3
 0.0149369 0.00567807 0.0288834 -0.00504617 0.261078 0.231787 -0.215439 0.804718 0.223834 0.182996 0.0201164 -0.00510435 -0.00341328 -0.00385978
 -0.00431385 -0.0459949 -0.0807693 0.149201  ; BSV_GENO_2
$SIGMA  0.0318979  ;     1. RUV
$SIGMA  1E-07  FIX  ;     EPSCOV
$ESTIMATION METHOD=IMPMAP AUTO=1 RANMETHOD=3P INTER NOABORT PRINT=1
            CITER=15 NOCOV=1 ISAMPEND=100 NITER=50 ISAMPLE=300 CTYPE=1
            CALPHA=0.001 PHITYPE=1
$ESTIMATION METHOD=IMPMAP INTER EONLY=1 NITER=5 ISAMPLE=1000 NOCOV=0 PHITYPE=1
$COVARIANCE PRINT=E MATRIX=S UNCONDITIONAL UNCONDITIONAL
$TABLE      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT AGE SEX RACE ETHNIC GENO SMOK AST ALT
            BILI BMI CRCL NCI NCIL RACEL RACEL1 RACEL2 RACEL3 GENO1
            GENO2 GENO3 GENO4 CPRED CIPREDI CWRES CIWRES ETAS(1:LAST)
            NOPRINT ONEHEADER FILE=xptab9

