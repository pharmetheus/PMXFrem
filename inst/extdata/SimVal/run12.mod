;; 1. Based on: 8
;; 2. Description:
;;    Including WT in the FREM part of the model
;; 3. Label:
;;    Base model
;------------------------------------------------------------------------------
$PROBLEM    run 1
$INPUT      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT AGE SEX RACE ETHNIC GENO SMOK AST ALT
            BILI BMI CRCL NCI NCIL RACEL RACEL1 RACEL2 RACEL3 GENO1
            GENO2 GENO3 GENO4 FREMTYPE
$DATA      frem11.dir/frem_dataset.dta IGNORE=@
$SUBROUTINE ADVAN2 TRANS2
$PK
;;; MATFOOD-DEFINITION START
IF(FOOD.EQ.1.0000E+00) MATFOOD = 1  ; Most common
IF(FOOD.EQ.0.0000E+00) MATFOOD = ( 1 + THETA(7))
;;; MATFOOD-DEFINITION END

;;; MAT-RELATION START
MATCOVTIME = MATFOOD
;;; MAT-RELATION END


;;; FRELFOOD-DEFINITION START
IF(FOOD.EQ.1.0000E+00) FRELFOOD = 1  ; Most common
IF(FOOD.EQ.0.0000E+00) FRELFOOD = ( 1 + THETA(6))
;;; FRELFOOD-DEFINITION END

;;; FREL-RELATION START
FRELCOVTIME = FRELFOOD
;;; FREL-RELATION END

 
TVFREL  = THETA(1)
TVCL    = THETA(2)
TVV     = THETA(3)
TVMAT   = THETA(4)
TVD1    = THETA(5)

;MU_1  = LOG(TVRUV)
MU_2  = TVD1
MU_3  = LOG(TVFREL)
MU_4  = LOG(TVCL)
MU_5  = LOG(TVV)
MU_6  = LOG(TVMAT)

D1FR  = MU_2                   + ETA(2)
FREL  = FRELCOVTIME * EXP(MU_3 + ETA(3))
CL    = EXP(MU_4               + ETA(4))
V     = EXP(MU_5               + ETA(5))
MAT   = MATCOVTIME * EXP(MU_6  + ETA(6))
D1    = MAT*(1-D1FR)

F1    = FREL
KA    = 1 / (MAT-D1)
S2    = V

     MU_7 = THETA(8)
     COV7 = MU_7 + ETA(7)
     MU_8 = THETA(9)
     COV8 = MU_8 + ETA(8)
     MU_9 = THETA(10)
     COV9 = MU_9 + ETA(9)
     MU_10 = THETA(11)
     COV10 = MU_10 + ETA(10)
     MU_11 = THETA(12)
     COV11 = MU_11 + ETA(11)
     MU_12 = THETA(13)
     COV12 = MU_12 + ETA(12)
     MU_13 = THETA(14)
     COV13 = MU_13 + ETA(13)
     MU_14 = THETA(15)
     COV14 = MU_14 + ETA(14)
     MU_15 = THETA(16)
     COV15 = MU_15 + ETA(15)
     MU_16 = THETA(17)
     COV16 = MU_16 + ETA(16)
     MU_17 = THETA(18)
     COV17 = MU_17 + ETA(17)
     MU_18 = THETA(19)
     COV18 = MU_18 + ETA(18)
     MU_19 = THETA(20)
     COV19 = MU_19 + ETA(19)
     MU_20 = THETA(21)
     COV20 = MU_20 + ETA(20)
     MU_21 = THETA(22)
     COV21 = MU_21 + ETA(21)
$ERROR
CP    = A(2)*1000 / V
IPRED = LOG(CP + 0.00001)
Y     = IPRED + EPS(1) * EXP(ETA(1))

;;;FREM CODE BEGIN COMPACT
;;;DO NOT MODIFY
     IF (FREMTYPE.EQ.100) THEN
;       WT  1
        Y = COV7 + EPS(2)
        IPRED = COV7
     END IF
     IF (FREMTYPE.EQ.200) THEN
;       AGE  1
        Y = COV8 + EPS(2)
        IPRED = COV8
     END IF
     IF (FREMTYPE.EQ.300) THEN
;       AST  1
        Y = COV9 + EPS(2)
        IPRED = COV9
     END IF
     IF (FREMTYPE.EQ.400) THEN
;       BILI  1
        Y = COV10 + EPS(2)
        IPRED = COV10
     END IF
     IF (FREMTYPE.EQ.500) THEN
;       CRCL  1
        Y = COV11 + EPS(2)
        IPRED = COV11
     END IF
     IF (FREMTYPE.EQ.600) THEN
;       BMI  1
        Y = COV12 + EPS(2)
        IPRED = COV12
     END IF
     IF (FREMTYPE.EQ.700) THEN
;       ALT  1
        Y = COV13 + EPS(2)
        IPRED = COV13
     END IF
     IF (FREMTYPE.EQ.800) THEN
;       SEX  1
        Y = COV14 + EPS(2)
        IPRED = COV14
     END IF
     IF (FREMTYPE.EQ.900) THEN
;       RACEL_3  1
        Y = COV15 + EPS(2)
        IPRED = COV15
     END IF
     IF (FREMTYPE.EQ.1000) THEN
;       RACEL_2  1
        Y = COV16 + EPS(2)
        IPRED = COV16
     END IF
     IF (FREMTYPE.EQ.1100) THEN
;       NCI_2  1
        Y = COV17 + EPS(2)
        IPRED = COV17
     END IF
     IF (FREMTYPE.EQ.1200) THEN
;       NCI_1  1
        Y = COV18 + EPS(2)
        IPRED = COV18
     END IF
     IF (FREMTYPE.EQ.1300) THEN
;       GENO_4  1
        Y = COV19 + EPS(2)
        IPRED = COV19
     END IF
     IF (FREMTYPE.EQ.1400) THEN
;       GENO_3  1
        Y = COV20 + EPS(2)
        IPRED = COV20
     END IF
     IF (FREMTYPE.EQ.1500) THEN
;       GENO_2  1
        Y = COV21 + EPS(2)
        IPRED = COV21
     END IF
;;;FREM CODE END COMPACT
$THETA  1 FIX ; 1. TVFREL
$THETA  (0,7.59825) ; 2. TVCL
$THETA  (0,148.033) ; 3. TVV
$THETA  (0,2.06146) ; 4. TVMAT
$THETA  (0,0.680844) ; 5. D1
$THETA  (-1.00,0.106503,3.00) ; 6. FRELFOOD1
$THETA  (-1.00,-0.0833563,3.00) ; 7. MATFOOD1
$THETA  86.818 ; TV_WT
 44.2958 ; TV_AGE
 24.9469 ; TV_AST
 9.66462 ; TV_BILI
 117.575 ; TV_CRCL
 30.1204 ; TV_BMI
 27.5456 ; TV_ALT
 1.44153 ; TV_SEX
 0.0246201 ; TV_RACEL_3
 0.206947 ; TV_RACEL_2
 0.016452 ; TV_NCI_2
 0.134542 ; TV_NCI_1
 0.0560966 ; TV_GENO_4
 0.0985753 ; TV_GENO_3
 0.818035 ; TV_GENO_2
$OMEGA  0.112517  ; 1. IIV on RUV
$OMEGA  0.0001  FIX  ;         D1
$OMEGA  BLOCK(19)
 0.277801  ; 2. IIV on FREL
 -0.0315938 0.152488  ; 3. IIV on CL
 -0.0486678 -0.0805527 0.28985  ; 4. IIV on V
 0.0222086 -0.0112962 0.0320588 0.156116  ; 5. IIV on MAT
 -1.47962 1.80658 3.0457 -0.831344 456.573  ;     BSV_WT
 -0.00937725 0.646137 0.626334 0.147386 44.6225 175.792  ;    BSV_AGE
 0.526927 0.312655 0.155837 -0.250651 9.48319 10.5186 122.655  ;    BSV_AST
 0.348429 0.0192692 0.186885 0.0978926 -13.1251 -8.86379 -3.74079 24.088  ;   BSV_BILI
 0.259239 2.57509 4.19194 -0.950906 299.25 -150.446 -6.49084 -5.04864 635.038  ;   BSV_CRCL
 -0.270932 0.48832 1.12364 -0.184717 115.816 17.7526 2.64665 -6.14609 80.8437 39.3703  ;    BSV_BMI
 0.64535 0.361291 0.420901 -0.433382 46.8646 12.7559 145.292 0.549374 25.6878 12.0095 263.349  ;    BSV_ALT
 0.0329357 -0.00230804 0.0514527 0.011451 -3.84802 -0.199288 -0.613975 -0.346349 -0.581951 -0.13247 -1.39355 0.246867  ;    BSV_SEX
 -0.00258398 -0.00245869 -0.00232036 -0.010933 -0.249598 0.0791309 0.0618746 0.0359715 -0.394465 -0.0669593 -0.0516286 -0.00403221
 0.0240833  ; BSV_RACEL_3
 0.00786674 -0.00504288 0.00333773 0.00489132 0.555783 -1.10793 0.0358078 0.0872056 0.16989 0.0400506 -0.743592 0.00877179 -0.00510808
 0.164286  ; BSV_RACEL_2
 0.00123772 -0.00159598 0.00299148 0.0016436 -0.202227 -0.0789482 -0.111507 0.347785 -0.115582 -0.0866721 -0.0747253 -0.00177257 -0.000406152
 0.000711171 0.0161903  ;  BSV_NCI_2
 0.0224398 -0.00222393 0.0108182 -0.00105524 0.702189 -0.0946651 1.37299 0.693327 0.636307 0.221343 2.7865 -0.015401 0.000800763 0.00237129
 -0.00220945 0.116383  ;  BSV_NCI_1
 -0.00555822 -0.00259749 -0.00532645 0.00190599 -0.199515 0.165792 -0.0404633 -0.0951645 -0.715611 -0.0887306 -0.126173 0.00125505 -0.00138723
 -0.00751841 -0.000924028 -0.00480627 0.0530823  ; BSV_GENO_4
 -0.00414062 -0.000816995 -0.010882 0.00128268 0.0965041 -0.454474 -0.0818323 0.197908 0.0124016 -0.0943914 -0.0242305 -0.0175026 0.00716758 0.0124919
 0.00386384 0.00594482 -0.00554692 0.0890231  ; BSV_GENO_3
 0.0176436 0.0112145 0.0355039 -0.00678598 0.250636 0.261128 0.231787 -0.215436 0.804606 0.223819 0.183016 0.0201175 -0.00510454 -0.00341381
 -0.00386018 -0.00431439 -0.0459948 -0.0807719 0.149204  ; BSV_GENO_2
$SIGMA  0.0319368  ;     1. RUV
$SIGMA  1E-07  FIX  ;     EPSCOV
$ESTIMATION METHOD=IMPMAP AUTO=1 RANMETHOD=3P INTER NOABORT PRINT=1
            CITER=15 NOCOV=1 ISAMPEND=100 NITER=50 ISAMPLE=300 CTYPE=1
            CALPHA=0.001
$ESTIMATION METHOD=IMPMAP INTER EONLY=1 NITER=5 ISAMPLE=1000 NOCOV=0
$COVARIANCE PRINT=E MATRIX=S UNCONDITIONAL UNCONDITIONAL
$TABLE      NO ID STUDYID TAD TIME DAY AMT RATE ODV DV EVID BLQ DOSE
            FOOD FORM TYPE WT HT AGE SEX RACE ETHNIC GENO SMOK AST ALT
            BILI BMI CRCL NCI NCIL RACEL RACEL1 RACEL2 RACEL3 GENO1
            GENO2 GENO3 GENO4 CPRED CIPREDI CWRES CIWRES ETAS(1:LAST)
            NOPRINT ONEHEADER FILE=xptab12

